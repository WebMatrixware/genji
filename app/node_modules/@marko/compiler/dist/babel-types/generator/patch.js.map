{"version":3,"sources":["../../../src/babel-types/generator/patch.js"],"names":["UNENCLOSED_WHITESPACE_TYPES","Object","assign","Printer","prototype","MarkoDocumentType","node","token","value","MarkoDeclaration","MarkoCDATA","MarkoComment","MarkoPlaceholder","parent","parentBody","body","prev","indexOf","t","isMarkoText","isMarkoPlaceholder","removeTrailingNewline","escape","print","MarkoScriptlet","isProgram","static","length","newline","indent","printSequence","dedent","MarkoClass","MarkoAttribute","default","name","modifier","arguments","printList","isBooleanLiteral","printWithParansIfNeeded","call","MarkoSpreadAttribute","MarkoText","concatToPrev","isMultiLine","test","isRootLevel","word","MarkoTagBody","MarkoTag","isDynamicTag","isStringLiteral","tagName","rawValue","var","params","attributes","printJoin","separator","spaceSeparator","SELF_CLOSING","voidElements","includes","svgElements","needsParans","hasUnenclosedWhitespace","type"],"mappings":"yLAAA;;AAEA;AACA;AACA;;AAEA,MAAMA,2BAA2B,GAAG;AAClC,mBADkC;AAElC,sBAFkC;AAGlC,uBAHkC;AAIlC,kBAJkC;AAKlC,eALkC;AAMlC,UANkC;AAOlC,sBAPkC,CAApC;;;AAUAC,MAAM,CAACC,MAAP,CAAcC,iBAAQC,SAAtB,EAAiC;AAC/BC,EAAAA,iBAAiB,CAACC,IAAD,EAAO;AACtB,SAAKC,KAAL,CAAW,IAAX;AACA,SAAKA,KAAL,CAAWD,IAAI,CAACE,KAAhB;AACA,SAAKD,KAAL,CAAW,GAAX;AACD,GAL8B;AAM/BE,EAAAA,gBAAgB,CAACH,IAAD,EAAO;AACrB,SAAKC,KAAL,CAAW,IAAX;AACA,SAAKA,KAAL,CAAWD,IAAI,CAACE,KAAhB;AACA,SAAKD,KAAL,CAAW,IAAX;AACD,GAV8B;AAW/BG,EAAAA,UAAU,CAACJ,IAAD,EAAO;AACf,SAAKC,KAAL,CAAW,WAAX;AACA,SAAKA,KAAL,CAAWD,IAAI,CAACE,KAAhB;AACA,SAAKD,KAAL,CAAW,KAAX;AACD,GAf8B;AAgB/BI,EAAAA,YAAY,CAACL,IAAD,EAAO;AACjB,SAAKC,KAAL,CAAW,MAAX;AACA,SAAKA,KAAL,CAAWD,IAAI,CAACE,KAAhB;AACA,SAAKD,KAAL,CAAW,KAAX;AACD,GApB8B;AAqB/BK,EAAAA,gBAAgB,CAACN,IAAD,EAAOO,MAAP,EAAe;AAC7B,QAAIA,MAAJ,EAAY;AACV,YAAMC,UAAU,GAAGD,MAAM,CAACE,IAA1B;AACA,YAAMC,IAAI,GAAGF,UAAU,CAACA,UAAU,CAACG,OAAX,CAAmBX,IAAnB,IAA2B,CAA5B,CAAvB;;AAEA,UAAIU,IAAI,KAAKE,CAAC,CAACC,WAAF,CAAcH,IAAd,KAAuBE,CAAC,CAACE,kBAAF,CAAqBJ,IAArB,CAA5B,CAAR,EAAiE;AAC/D,aAAKK,qBAAL;AACD;AACF;;AAED,SAAKd,KAAL,CAAWD,IAAI,CAACgB,MAAL,GAAc,IAAd,GAAqB,KAAhC;AACA,SAAKC,KAAL,CAAWjB,IAAI,CAACE,KAAhB,EAAuBF,IAAvB;AACA,SAAKC,KAAL,CAAW,GAAX;AACD,GAlC8B;AAmC/BiB,EAAAA,cAAc,CAAClB,IAAD,EAAOO,MAAP,EAAe;AAC3B,SAAKQ,qBAAL;;AAEA,QAAI,EAAEH,CAAC,CAACO,SAAF,CAAYZ,MAAZ,KAAuBA,MAAM,CAACE,IAAP,CAAYE,OAAZ,CAAoBX,IAApB,MAA8B,CAAvD,CAAJ,EAA+D;AAC7D,WAAKC,KAAL,CAAW,IAAX;AACD;;AAED,SAAKA,KAAL,CAAY,GAAED,IAAI,CAACoB,MAAL,GAAc,QAAd,GAAyB,GAAI,GAA3C;;AAEA,QAAIpB,IAAI,CAACS,IAAL,CAAUY,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACA,WAAKJ,KAAL,CAAWjB,IAAI,CAACS,IAAL,CAAU,CAAV,CAAX,EAAyBT,IAAzB;AACD,KAHD,MAGO;AACL,WAAKC,KAAL,CAAW,GAAX;AACA,WAAKqB,OAAL;AACA,WAAKC,MAAL;AACA,WAAKC,aAAL,CAAmBxB,IAAI,CAACS,IAAxB,EAA8BT,IAA9B;AACA,WAAKyB,MAAL;AACA,WAAKxB,KAAL,CAAW,GAAX;AACD;AACF,GAvD8B;AAwD/ByB,EAAAA,UAAU,CAAC1B,IAAD,EAAO;AACf,SAAKC,KAAL,CAAW,OAAX;AACA,SAAKA,KAAL,CAAW,GAAX;AACA,SAAKgB,KAAL,CAAWjB,IAAI,CAACS,IAAhB,EAAsBT,IAAtB;AACD,GA5D8B;AA6D/B2B,EAAAA,cAAc,CAAC3B,IAAD,EAAO;AACnB,QAAI,CAACA,IAAI,CAAC4B,OAAV,EAAmB;AACjB,WAAK3B,KAAL,CAAWD,IAAI,CAAC6B,IAAhB;;AAEA,UAAI7B,IAAI,CAAC8B,QAAT,EAAmB;AACjB,aAAK7B,KAAL,CAAW,GAAX;AACA,aAAKA,KAAL,CAAWD,IAAI,CAAC8B,QAAhB;AACD;;AAED,UAAI9B,IAAI,CAAC+B,SAAL,IAAkB/B,IAAI,CAAC+B,SAAL,CAAeV,MAArC,EAA6C;AAC3C,aAAKpB,KAAL,CAAW,GAAX;AACA,aAAK+B,SAAL,CAAehC,IAAI,CAAC+B,SAApB,EAA+B/B,IAA/B;AACA,aAAKC,KAAL,CAAW,GAAX;AACD;AACF;;AAED,QAAID,IAAI,CAAC4B,OAAL,IAAgB,CAAChB,CAAC,CAACqB,gBAAF,CAAmBjC,IAAI,CAACE,KAAxB,CAAjB,IAAmD,CAACF,IAAI,CAACE,KAAL,CAAWA,KAAnE,EAA0E;AACxE,WAAKD,KAAL,CAAW,GAAX;AACAiC,MAAAA,uBAAuB,CAACC,IAAxB,CAA6B,IAA7B,EAAmCnC,IAAI,CAACE,KAAxC,EAA+CF,IAA/C;AACD;AACF,GAjF8B;AAkF/BoC,EAAAA,oBAAoB,CAACpC,IAAD,EAAO;AACzB,SAAKC,KAAL,CAAW,KAAX;AACAiC,IAAAA,uBAAuB,CAACC,IAAxB,CAA6B,IAA7B,EAAmCnC,IAAI,CAACE,KAAxC,EAA+CF,IAA/C;AACD,GArF8B;AAsF/BqC,EAAAA,SAAS,CAACrC,IAAD,EAAOO,MAAP,EAAe;AACtB,UAAMC,UAAU,GAAGD,MAAM,CAACE,IAA1B;AACA,UAAMC,IAAI,GAAGF,UAAU,CAACA,UAAU,CAACG,OAAX,CAAmBX,IAAnB,IAA2B,CAA5B,CAAvB;AACA,UAAMsC,YAAY,GAAG5B,IAAI,IAAIE,CAAC,CAACE,kBAAF,CAAqBJ,IAArB,CAA7B;AACA,QAAI,EAAER,KAAF,KAAYF,IAAhB;;AAEA,QAAIsC,YAAJ,EAAkB;AAChB,WAAKvB,qBAAL;AACD;;AAED,UAAMwB,WAAW,GAAG,UAAUC,IAAV,CAAetC,KAAf,CAApB;AACA,UAAMuC,WAAW,GAAG,CAACH,YAAD,IAAiB1B,CAAC,CAACO,SAAF,CAAYZ,MAAZ,CAArC;;AAEA,QAAIkC,WAAJ,EAAiB;AACf,UAAIF,WAAJ,EAAiB;AACf,aAAKtC,KAAL,CAAW,OAAX;AACD,OAFD,MAEO;AACL,aAAKA,KAAL,CAAW,KAAX;AACD;AACF;;AAED,SAAKyC,IAAL,CAAUxC,KAAV;;AAEA,QAAIqC,WAAW,IAAIE,WAAnB,EAAgC;AAC9B,WAAKxC,KAAL,CAAW,OAAX;AACD;AACF,GAhH8B;AAiH/B0C,EAAAA,YAAY,CAAC3C,IAAD,EAAO;AACjB,SAAKwB,aAAL,CAAmBxB,IAAI,CAACS,IAAxB,EAA8BT,IAA9B,EAAoC,EAAEuB,MAAM,EAAE,IAAV,EAApC;AACD,GAnH8B;AAoH/BqB,EAAAA,QAAQ,CAAC5C,IAAD,EAAO;AACb,UAAM6C,YAAY,GAAG,CAACjC,CAAC,CAACkC,eAAF,CAAkB9C,IAAI,CAAC6B,IAAvB,CAAtB;AACA,UAAMkB,OAAO,GAAG,CAACF,YAAD,IAAiB7C,IAAI,CAAC6B,IAAL,CAAU3B,KAA3C;AACA,UAAM8C,QAAQ,GAAGhD,IAAI,CAACgD,QAAtB;;AAEA;AACED,IAAAA,OAAO,KAAK,OAAZ;AACA,wCAAoCP,IAApC,CAAyCQ,QAAzC,CAFF;AAGE;AACA,WAAK/C,KAAL,CAAW+C,QAAX;AACA;AACD;;AAED,SAAK/C,KAAL,CAAW,GAAX;;AAEA,QAAI+C,QAAJ,EAAc;AACZ,WAAK/C,KAAL,CAAW+C,QAAX;AACD,KAFD,MAEO;AACL,UAAIH,YAAJ,EAAkB;AAChB,aAAK5C,KAAL,CAAW,IAAX;AACA,aAAKgB,KAAL,CAAWjB,IAAI,CAAC6B,IAAhB,EAAsB7B,IAAtB;AACA,aAAKC,KAAL,CAAW,GAAX;AACD,OAJD,MAIO;AACL,aAAKA,KAAL,CAAW8C,OAAX;AACD;;AAED,UAAI/C,IAAI,CAACiD,GAAT,EAAc;AACZ,aAAKhD,KAAL,CAAW,GAAX;AACA,aAAKgB,KAAL,CAAWjB,IAAI,CAACiD,GAAhB,EAAqBjD,IAArB;AACD;;AAED,UAAIA,IAAI,CAAC+B,SAAL,IAAkB/B,IAAI,CAAC+B,SAAL,CAAeV,MAArC,EAA6C;AAC3C,aAAKpB,KAAL,CAAW,GAAX;AACA,aAAK+B,SAAL,CAAehC,IAAI,CAAC+B,SAApB,EAA+B/B,IAA/B;AACA,aAAKC,KAAL,CAAW,GAAX;AACD;;AAED,UAAID,IAAI,CAACS,IAAL,CAAUyC,MAAV,CAAiB7B,MAArB,EAA6B;AAC3B,aAAKpB,KAAL,CAAW,GAAX;AACA,aAAK+B,SAAL,CAAehC,IAAI,CAACS,IAAL,CAAUyC,MAAzB,EAAiClD,IAAjC;AACA,aAAKC,KAAL,CAAW,GAAX;AACD;;AAED,UAAID,IAAI,CAACmD,UAAL,CAAgB9B,MAApB,EAA4B;AAC1B;AACE,UAAErB,IAAI,CAACmD,UAAL,IAAmBnD,IAAI,CAACmD,UAAL,CAAgB,CAAhB,CAAnB,IAAyCnD,IAAI,CAACmD,UAAL,CAAgB,CAAhB,EAAmBvB,OAA9D,CADF;AAEE;AACA,eAAK3B,KAAL,CAAW,GAAX;AACD;;AAED,aAAKmD,SAAL,CAAepD,IAAI,CAACmD,UAApB,EAAgCnD,IAAhC,EAAsC,EAAEqD,SAAS,EAAEC,cAAb,EAAtC;AACD;AACF;;AAED,QAAIC,yBAAaC,YAAb,CAA0BC,QAA1B,CAAmCV,OAAnC,CAAJ,EAAiD;AAC/C,WAAK9C,KAAL,CAAW,GAAX;AACD,KAFD,MAEO;AACL,KAACD,IAAI,CAACS,IAAL,CAAUA,IAAV,CAAeY,MAAhB;AACAkC,6BAAaG,WAAb,CAAyBD,QAAzB,CAAkCV,OAAlC,CAFK;AAGL;AACA,WAAK9C,KAAL,CAAW,IAAX;AACD,KALM,MAKA;AACL,WAAKA,KAAL,CAAW,GAAX;AACA,WAAKqB,OAAL;AACA,WAAKL,KAAL,CAAWjB,IAAI,CAACS,IAAhB,EAAsBT,IAAtB;AACA,WAAKC,KAAL,CAAW,IAAX;AACA,UAAI,CAAC4C,YAAL,EAAmB;AACjB,aAAK5C,KAAL,CAAW8C,OAAX;AACD;AACD,WAAK9C,KAAL,CAAW,GAAX;AACD;AACF,GA3L8B,EAAjC;;;AA8LA,SAASqD,cAAT,GAA0B;AACxB,OAAKrD,KAAL,CAAW,GAAX;AACD;;AAED,SAASiC,uBAAT,CAAiChC,KAAjC,EAAwCK,MAAxC,EAAgD;AAC9C,QAAMoD,WAAW,GAAGC,uBAAuB,CAAC1D,KAAD,CAA3C;;AAEA,MAAIyD,WAAJ,EAAiB;AACf,SAAK1D,KAAL,CAAW,GAAX;AACD;;AAED,OAAKgB,KAAL,CAAWf,KAAX,EAAkBK,MAAlB;;AAEA,MAAIoD,WAAJ,EAAiB;AACf,SAAK1D,KAAL,CAAW,GAAX;AACD;AACF;;AAED,SAAS2D,uBAAT,CAAiC5D,IAAjC,EAAuC;AACrC,SAAON,2BAA2B,CAAC+D,QAA5B,CAAqCzD,IAAI,CAAC6D,IAA1C,CAAP;AACD","sourcesContent":["import \"../types/patch\";\n\nimport * as t from \"@babel/types\";\nimport SELF_CLOSING from \"self-closing-tags\";\nimport Printer from \"@babel/generator/lib/printer\";\n\nconst UNENCLOSED_WHITESPACE_TYPES = [\n  \"LogicalExpression\",\n  \"AssignmentExpression\",\n  \"ConditionalExpression\",\n  \"BinaryExpression\",\n  \"NewExpression\",\n  \"Function\",\n  \"AssignmentExpression\"\n];\n\nObject.assign(Printer.prototype, {\n  MarkoDocumentType(node) {\n    this.token(\"<!\");\n    this.token(node.value);\n    this.token(\">\");\n  },\n  MarkoDeclaration(node) {\n    this.token(\"<?\");\n    this.token(node.value);\n    this.token(\"?>\");\n  },\n  MarkoCDATA(node) {\n    this.token(\"<![CDATA[\");\n    this.token(node.value);\n    this.token(\"]]>\");\n  },\n  MarkoComment(node) {\n    this.token(\"<!--\");\n    this.token(node.value);\n    this.token(\"-->\");\n  },\n  MarkoPlaceholder(node, parent) {\n    if (parent) {\n      const parentBody = parent.body;\n      const prev = parentBody[parentBody.indexOf(node) - 1];\n\n      if (prev && (t.isMarkoText(prev) || t.isMarkoPlaceholder(prev))) {\n        this.removeTrailingNewline();\n      }\n    }\n\n    this.token(node.escape ? \"${\" : \"$!{\");\n    this.print(node.value, node);\n    this.token(\"}\");\n  },\n  MarkoScriptlet(node, parent) {\n    this.removeTrailingNewline();\n\n    if (!(t.isProgram(parent) && parent.body.indexOf(node) === 0)) {\n      this.token(\"\\n\");\n    }\n\n    this.token(`${node.static ? \"static\" : \"$\"} `);\n\n    if (node.body.length === 1) {\n      // TODO should determine if node has unenclosed newlines.\n      this.print(node.body[0], node);\n    } else {\n      this.token(\"{\");\n      this.newline();\n      this.indent();\n      this.printSequence(node.body, node);\n      this.dedent();\n      this.token(\"}\");\n    }\n  },\n  MarkoClass(node) {\n    this.token(\"class\");\n    this.token(\" \");\n    this.print(node.body, node);\n  },\n  MarkoAttribute(node) {\n    if (!node.default) {\n      this.token(node.name);\n\n      if (node.modifier) {\n        this.token(\":\");\n        this.token(node.modifier);\n      }\n\n      if (node.arguments && node.arguments.length) {\n        this.token(\"(\");\n        this.printList(node.arguments, node);\n        this.token(\")\");\n      }\n    }\n\n    if (node.default || !t.isBooleanLiteral(node.value) || !node.value.value) {\n      this.token(\"=\");\n      printWithParansIfNeeded.call(this, node.value, node);\n    }\n  },\n  MarkoSpreadAttribute(node) {\n    this.token(\"...\");\n    printWithParansIfNeeded.call(this, node.value, node);\n  },\n  MarkoText(node, parent) {\n    const parentBody = parent.body;\n    const prev = parentBody[parentBody.indexOf(node) - 1];\n    const concatToPrev = prev && t.isMarkoPlaceholder(prev);\n    let { value } = node;\n\n    if (concatToPrev) {\n      this.removeTrailingNewline();\n    }\n\n    const isMultiLine = /[\\r\\n]/g.test(value);\n    const isRootLevel = !concatToPrev && t.isProgram(parent);\n\n    if (isRootLevel) {\n      if (isMultiLine) {\n        this.token(\"---\\n\");\n      } else {\n        this.token(\"-- \");\n      }\n    }\n\n    this.word(value);\n\n    if (isMultiLine && isRootLevel) {\n      this.token(\"\\n---\");\n    }\n  },\n  MarkoTagBody(node) {\n    this.printSequence(node.body, node, { indent: true });\n  },\n  MarkoTag(node) {\n    const isDynamicTag = !t.isStringLiteral(node.name);\n    const tagName = !isDynamicTag && node.name.value;\n    const rawValue = node.rawValue;\n\n    if (\n      tagName === \"style\" &&\n      /^style(?:\\.[^\\s]+)?\\s*\\{[\\s\\S]*}$/.test(rawValue)\n    ) {\n      this.token(rawValue);\n      return;\n    }\n\n    this.token(\"<\");\n\n    if (rawValue) {\n      this.token(rawValue);\n    } else {\n      if (isDynamicTag) {\n        this.token(\"${\");\n        this.print(node.name, node);\n        this.token(\"}\");\n      } else {\n        this.token(tagName);\n      }\n\n      if (node.var) {\n        this.token(\"/\");\n        this.print(node.var, node);\n      }\n\n      if (node.arguments && node.arguments.length) {\n        this.token(\"(\");\n        this.printList(node.arguments, node);\n        this.token(\")\");\n      }\n\n      if (node.body.params.length) {\n        this.token(\"|\");\n        this.printList(node.body.params, node);\n        this.token(\"|\");\n      }\n\n      if (node.attributes.length) {\n        if (\n          !(node.attributes && node.attributes[0] && node.attributes[0].default)\n        ) {\n          this.token(\" \");\n        }\n\n        this.printJoin(node.attributes, node, { separator: spaceSeparator });\n      }\n    }\n\n    if (SELF_CLOSING.voidElements.includes(tagName)) {\n      this.token(\">\");\n    } else if (\n      !node.body.body.length ||\n      SELF_CLOSING.svgElements.includes(tagName)\n    ) {\n      this.token(\"/>\");\n    } else {\n      this.token(\">\");\n      this.newline();\n      this.print(node.body, node);\n      this.token(\"</\");\n      if (!isDynamicTag) {\n        this.token(tagName);\n      }\n      this.token(\">\");\n    }\n  }\n});\n\nfunction spaceSeparator() {\n  this.token(\" \");\n}\n\nfunction printWithParansIfNeeded(value, parent) {\n  const needsParans = hasUnenclosedWhitespace(value);\n\n  if (needsParans) {\n    this.token(\"(\");\n  }\n\n  this.print(value, parent);\n\n  if (needsParans) {\n    this.token(\")\");\n  }\n}\n\nfunction hasUnenclosedWhitespace(node) {\n  return UNENCLOSED_WHITESPACE_TYPES.includes(node.type);\n}\n"],"file":"patch.js"}