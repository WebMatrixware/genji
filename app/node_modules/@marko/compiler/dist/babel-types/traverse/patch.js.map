{"version":3,"sources":["../../../src/babel-types/traverse/patch.js"],"names":["MARKO_TYPES","forEach","typeName","checkKey","assertKey","checkFn","t","assertFn","NodePath","prototype","opts","node","MARKO_ALIAS_TYPES","aliasName","originalProtoCheck","is","call","originalCrawl","Scope","crawl","path","originalTraverse","traverse","visitor","Object","assign","explode","MarkoTagBody","body","param","get","scope","registerBinding","MarkoTag","tag","has","apply","arguments"],"mappings":"oGAAA;;AAEA;AACA;AACA;;AAEAA,yBAAYC,OAAZ,CAAoBC,QAAQ,IAAI;AAC9B,QAAMC,QAAQ,GAAI,KAAID,QAAS,EAA/B;AACA,QAAME,SAAS,GAAI,SAAQF,QAAS,EAApC;AACA,QAAMG,OAAO,GAAGC,CAAC,CAACH,QAAD,CAAjB;AACA,QAAMI,QAAQ,GAAGD,CAAC,CAACF,SAAD,CAAlB;AACAI,qBAASC,SAAT,CAAmBN,QAAnB,IAA+B,UAAUO,IAAV,EAAgB;AAC7C,WAAOL,OAAO,CAAC,KAAKM,IAAN,EAAYD,IAAZ,CAAd;AACD,GAFD;AAGAF,qBAASC,SAAT,CAAmBL,SAAnB,IAAgC,UAAUM,IAAV,EAAgB;AAC9CH,IAAAA,QAAQ,CAAC,KAAKI,IAAN,EAAYD,IAAZ,CAAR;AACD,GAFD;AAGD,CAXD;;AAaAE,+BAAkBX,OAAlB,CAA0BY,SAAS,IAAI;AACrC,QAAMV,QAAQ,GAAI,KAAIU,SAAU,EAAhC;AACA,QAAMC,kBAAkB,GAAGN,mBAASC,SAAT,CAAmBN,QAAnB,CAA3B;AACAK,qBAASC,SAAT,CAAmBN,QAAnB,IAA+B,UAAUO,IAAV,EAAgB;AAC7C;AACEJ,MAAAA,CAAC,CAACS,EAAF,CAAKF,SAAL,EAAgB,KAAKF,IAArB,EAA2BD,IAA3B;AACAI,MAAAA,kBAAkB,CAACE,IAAnB,CAAwB,IAAxB,EAA8B,KAAKL,IAAnC,EAAyCD,IAAzC,CAFF;;AAID,GALD;AAMD,CATD;;AAWA;AACA;AACA,MAAMO,aAAa,GAAGC,gBAAMT,SAAN,CAAgBU,KAAtC;AACAD,gBAAMT,SAAN,CAAgBU,KAAhB,GAAwB,YAAY;AAClC,QAAMC,IAAI,GAAG,KAAKA,IAAlB;AACA,QAAMC,gBAAgB,GAAGD,IAAI,CAACE,QAA9B;AACAF,EAAAA,IAAI,CAACE,QAAL,GAAgB,UAAUC,OAAV,EAAmB;AACjCC,IAAAA,MAAM,CAACC,MAAP;AACEH,sBAASI,OAAT,CAAiBH,OAAjB,CADF;AAEED,sBAASI,OAAT,CAAiB;AACfC,MAAAA,YAAY,CAACC,IAAD,EAAO;AACjB,aAAK,MAAMC,KAAX,IAAoBD,IAAI,CAACE,GAAL,CAAS,QAAT,CAApB,EAAwC;AACtCF,UAAAA,IAAI,CAACG,KAAL,CAAWC,eAAX,CAA2B,OAA3B,EAAoCH,KAApC;AACD;AACF,OALc;AAMfI,MAAAA,QAAQ,CAACC,GAAD,EAAM;AACZ,YAAIA,GAAG,CAACC,GAAJ,CAAQ,KAAR,CAAJ,EAAoB;AAClBD,UAAAA,GAAG,CAACH,KAAJ,CAAUC,eAAV,CAA0B,OAA1B,EAAmCE,GAAG,CAACJ,GAAJ,CAAQ,KAAR,CAAnC,EAAmDI,GAAnD;AACD;AACF,OAVc,EAAjB,CAFF;;;;AAgBAd,IAAAA,IAAI,CAACE,QAAL,GAAgBD,gBAAhB;AACA,WAAOA,gBAAgB,CAACe,KAAjB,CAAuB,IAAvB,EAA6BC,SAA7B,CAAP;AACD,GAnBD;;AAqBAnB,kBAAMT,SAAN,CAAgBU,KAAhB,GAAwBF,aAAxB;AACAA,EAAAA,aAAa,CAACmB,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACD,CA1BD","sourcesContent":["import \"../types/patch\";\n\nimport * as t from \"@babel/types\";\nimport traverse, { NodePath, Scope } from \"@babel/traverse\";\nimport { MARKO_TYPES, MARKO_ALIAS_TYPES } from \"../types/definitions\";\n\nMARKO_TYPES.forEach(typeName => {\n  const checkKey = `is${typeName}`;\n  const assertKey = `assert${typeName}`;\n  const checkFn = t[checkKey];\n  const assertFn = t[assertKey];\n  NodePath.prototype[checkKey] = function (opts) {\n    return checkFn(this.node, opts);\n  };\n  NodePath.prototype[assertKey] = function (opts) {\n    assertFn(this.node, opts);\n  };\n});\n\nMARKO_ALIAS_TYPES.forEach(aliasName => {\n  const checkKey = `is${aliasName}`;\n  const originalProtoCheck = NodePath.prototype[checkKey];\n  NodePath.prototype[checkKey] = function (opts) {\n    return (\n      t.is(aliasName, this.node, opts) ||\n      originalProtoCheck.call(this, this.node, opts)\n    );\n  };\n});\n\n// Adds a one time patch to the scope collector visitors to include\n// Marko bindings for params and tag vars.\nconst originalCrawl = Scope.prototype.crawl;\nScope.prototype.crawl = function () {\n  const path = this.path;\n  const originalTraverse = path.traverse;\n  path.traverse = function (visitor) {\n    Object.assign(\n      traverse.explode(visitor),\n      traverse.explode({\n        MarkoTagBody(body) {\n          for (const param of body.get(\"params\")) {\n            body.scope.registerBinding(\"param\", param);\n          }\n        },\n        MarkoTag(tag) {\n          if (tag.has(\"var\")) {\n            tag.scope.registerBinding(\"local\", tag.get(\"var\"), tag);\n          }\n        }\n      })\n    );\n\n    path.traverse = originalTraverse;\n    return originalTraverse.apply(this, arguments);\n  };\n\n  Scope.prototype.crawl = originalCrawl;\n  originalCrawl.apply(this, arguments);\n};\n"],"file":"patch.js"}