{"version":3,"sources":["../../../src/taglib/lookup/index.js"],"names":["ok","require","taglibTypes","extend","hasOwnProperty","Object","prototype","TAG_COMPARATOR","a","b","name","localeCompare","merge","target","source","k","call","__noMerge","Array","isArray","targetArray","sourceArray","concat","Ctor","constructor","newTarget","TaglibLookup","merged","attributeGroups","taglibsById","_sortedTags","undefined","hasTaglib","taglib","id","_mergeNestedTags","Tag","handleNestedTags","tag","parentTagName","key","nestedTags","nestedTag","fullyQualifiedName","clonedNestedTag","tags","addTaglib","attributes","patternAttributes","getTagsSorted","sortedTags","tagName","push","sort","forEachAttribute","callback","globalAttributes","taglibAttributeGroups","findAttributesForTagName","handleAttr","attrDef","ref","attrName","i","length","attributeGroupName","attributeGroup","forEach","getTag","element","getAttribute","attr","findAttributeForTag","attribute","len","patternAttribute","pattern","test","tryAttribute","toString","keys","join","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar ok = require(\"assert\").ok;\nvar taglibTypes = require(\"../loader/types\");\nvar extend = require(\"raptor-util/extend\");\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction TAG_COMPARATOR(a, b) {\n  return a.name.localeCompare(b.name);\n}\n\nfunction merge(target, source) {\n  for (var k in source) {\n    if (hasOwnProperty.call(source, k)) {\n      if (\n        target[k] &&\n        typeof target[k] === \"object\" &&\n        source[k] &&\n        typeof source[k] === \"object\"\n      ) {\n        if (source.__noMerge) {\n          // Don't merge objects that are explicitly marked as \"do not merge\"\n          continue;\n        }\n\n        if (Array.isArray(target[k]) || Array.isArray(source[k])) {\n          var targetArray = target[k];\n          var sourceArray = source[k];\n\n          if (!Array.isArray(targetArray)) {\n            targetArray = [targetArray];\n          }\n\n          if (!Array.isArray(sourceArray)) {\n            sourceArray = [sourceArray];\n          }\n\n          target[k] = [].concat(targetArray).concat(sourceArray);\n        } else {\n          var Ctor = target[k].constructor;\n          var newTarget = new Ctor();\n          merge(newTarget, target[k]);\n          merge(newTarget, source[k]);\n          target[k] = newTarget;\n        }\n      } else {\n        target[k] = source[k];\n      }\n    }\n  }\n\n  return target;\n}\n\n/**\n * A taglib lookup merges in multiple taglibs so there is a single and fast lookup\n * for custom tags and custom attributes.\n */\nclass TaglibLookup {\n  constructor() {\n    this.merged = {\n      attributeGroups: {}\n    };\n    this.taglibsById = {};\n\n    this._sortedTags = undefined;\n  }\n\n  hasTaglib(taglib) {\n    return hasOwnProperty.call(this.taglibsById, taglib.id);\n  }\n\n  _mergeNestedTags(taglib) {\n    var Tag = taglibTypes.Tag;\n    // Loop over all of the nested tags and register a new custom tag\n    // with the fully qualified name\n\n    var merged = this.merged;\n\n    function handleNestedTags(tag, parentTagName) {\n      for (const key in tag.nestedTags) {\n        const nestedTag = tag.nestedTags[key];\n\n        var fullyQualifiedName = parentTagName + \":\" + nestedTag.name;\n        // Create a clone of the nested tag since we need to add some new\n        // properties\n        var clonedNestedTag = new Tag();\n        extend(clonedNestedTag, nestedTag);\n        // Record the fully qualified name of the parent tag that this\n        // custom tag is associated with.\n        clonedNestedTag.parentTagName = parentTagName;\n        clonedNestedTag.name = fullyQualifiedName;\n        merged.tags[fullyQualifiedName] = clonedNestedTag;\n        handleNestedTags(clonedNestedTag, fullyQualifiedName);\n      }\n    }\n\n    for (const key in taglib.tags) {\n      const tag = taglib.tags[key];\n      handleNestedTags(tag, tag.name);\n    }\n  }\n\n  addTaglib(taglib) {\n    ok(taglib, '\"taglib\" is required');\n    ok(taglib.id, '\"taglib.id\" expected');\n\n    if (hasOwnProperty.call(this.taglibsById, taglib.id)) {\n      return;\n    }\n\n    // console.log(\"TAGLIB:\", taglib);\n\n    this._sortedTags = undefined;\n\n    this.taglibsById[taglib.id] = taglib;\n\n    merge(this.merged, {\n      tags: taglib.tags,\n      attributes: taglib.attributes,\n      patternAttributes: taglib.patternAttributes,\n      attributeGroups: taglib.attributeGroups || {}\n    });\n\n    this._mergeNestedTags(taglib);\n  }\n\n  getTagsSorted() {\n    var sortedTags = this._sortedTags;\n\n    if (sortedTags === undefined) {\n      sortedTags = this._sortedTags = [];\n      var tags = this.merged.tags;\n      for (var tagName in tags) {\n        sortedTags.push(tags[tagName]);\n      }\n      sortedTags.sort(TAG_COMPARATOR);\n    }\n\n    return sortedTags;\n  }\n\n  forEachAttribute(tagName, callback) {\n    var tags = this.merged.tags;\n    if (!tags) {\n      return;\n    }\n\n    var globalAttributes = this.merged.attributes;\n    var taglibAttributeGroups = this.merged.attributeGroups;\n\n    function findAttributesForTagName(tagName) {\n      var tag = tags[tagName];\n      if (!tag) {\n        return;\n      }\n\n      function handleAttr(attrDef) {\n        if (attrDef.ref) {\n          attrDef = globalAttributes[attrDef.ref];\n        }\n        callback(attrDef, tag);\n      }\n\n      var attributes = tag.attributes;\n      if (!attributes) {\n        return;\n      }\n\n      for (var attrName in attributes) {\n        if (hasOwnProperty.call(attributes, attrName)) {\n          handleAttr(attributes[attrName], tag);\n        }\n      }\n\n      if (tag.attributeGroups) {\n        for (let i = 0; i < tag.attributeGroups.length; i++) {\n          let attributeGroupName = tag.attributeGroups[i];\n          let attributeGroup = taglibAttributeGroups[attributeGroupName];\n          if (attributeGroup) {\n            for (let attrName in attributeGroup) {\n              handleAttr(attributeGroup[attrName]);\n            }\n          }\n        }\n      }\n\n      if (tag.patternAttributes) {\n        tag.patternAttributes.forEach(handleAttr);\n      }\n    }\n\n    findAttributesForTagName(tagName); // Look for an exact match at the tag level\n    findAttributesForTagName(\"*\"); // Including attributes that apply to all tags\n  }\n\n  getTag(element) {\n    var tags = this.merged.tags;\n    if (!tags) {\n      return;\n    }\n\n    return tags[element.tagName || element];\n  }\n\n  getAttribute(element, attr) {\n    if (typeof element === \"string\") {\n      element = {\n        tagName: element\n      };\n    }\n\n    if (typeof attr === \"string\") {\n      attr = {\n        name: attr\n      };\n    }\n\n    var tags = this.merged.tags;\n    if (!tags) {\n      return;\n    }\n\n    var taglibAttributeGroups = this.merged.attributeGroups;\n\n    var tagName = element.tagName;\n    var attrName = attr.name;\n\n    function findAttributeForTag(tag, attributes, attrName) {\n      // try by exact match first\n      var attribute = attributes[attrName];\n      if (attribute === undefined) {\n        if (tag.attributeGroups) {\n          for (let i = 0; i < tag.attributeGroups.length; i++) {\n            let attributeGroupName = tag.attributeGroups[i];\n            let attributeGroup = taglibAttributeGroups[attributeGroupName];\n            if (attributeGroup) {\n              attribute = attributeGroup[attrName];\n              if (attribute !== undefined) {\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      if (attribute === undefined && attrName !== \"*\") {\n        if (tag.patternAttributes) {\n          // try searching by pattern\n          for (var i = 0, len = tag.patternAttributes.length; i < len; i++) {\n            var patternAttribute = tag.patternAttributes[i];\n            if (patternAttribute.pattern.test(attrName)) {\n              attribute = patternAttribute;\n              break;\n            }\n          }\n        }\n      }\n\n      return attribute;\n    }\n\n    var globalAttributes = this.merged.attributes;\n\n    function tryAttribute(tagName, attrName) {\n      var tag = tags[tagName];\n      if (!tag) {\n        return undefined;\n      }\n\n      return findAttributeForTag(tag, tag.attributes, attrName);\n    }\n\n    var attrDef =\n      tryAttribute(tagName, attrName) || // Look for an exact match at the tag level\n      tryAttribute(\"*\", attrName) || // If not there, see if there is a exact match on the attribute name for attributes that apply to all tags\n      tryAttribute(tagName, \"*\"); // Otherwise, see if there is a splat attribute for the tag\n\n    if (attrDef && attrDef.ref) {\n      attrDef = globalAttributes[attrDef.ref];\n    }\n\n    return attrDef;\n  }\n\n  toString() {\n    return \"lookup: \" + Object.keys(this.taglibsById).join(\", \");\n  }\n}\n\nmodule.exports = TaglibLookup;\n"],"file":"index.js"}