{"version":3,"sources":["../../../src/taglib/core/transform-style.js"],"names":["STYLE_REG","path","hub","node","deps","file","metadata","marko","rawValue","matchedBlock","exec","parentPath","isProgram","get","buildCodeFrameError","some","dep","style","styleFile","startContent","type","codeSartOffset","length","codeEndOffset","lastIndexOf","code","slice","base","opts","sourceFileName","start","extra","nameStart","push","startPos","endPos","virtualPath","remove"],"mappings":"uJAAA;AACA;;AAEA,MAAMA,SAAS,GAAG,4BAAlB;;AAEe,kBAAUC,IAAV,EAAgB;AAC7B,QAAM,EAAEC,GAAF,EAAOC,IAAP,KAAgBF,IAAtB;AACA,QAAM,EAAEG,IAAF,KAAWF,GAAG,CAACG,IAAJ,CAASC,QAAT,CAAkBC,KAAnC;AACA,QAAM,EAAEC,QAAF,KAAeL,IAArB;AACA,QAAMM,YAAY,GAAGT,SAAS,CAACU,IAAV,CAAeF,QAAf,CAArB;AACA,MAAI,CAACC,YAAL,EAAmB;AACjB;AACD;;AAED,MAAI,CAACR,IAAI,CAACU,UAAL,CAAgBC,SAAhB,EAAL,EAAkC;AAChC,UAAMX,IAAI;AACPY,IAAAA,GADG,CACC,MADD;AAEHC,IAAAA,mBAFG;AAGF,8DAHE,CAAN;;AAKD;;AAED,MAAIV,IAAI,CAACW,IAAL,CAAUC,GAAG,IAAIA,GAAG,CAACC,KAArB,CAAJ,EAAiC;AAC/B,UAAMhB,IAAI;AACPY,IAAAA,GADG,CACC,MADD;AAEHC,IAAAA,mBAFG;AAGF,gEAHE,CAAN;;AAKD;;AAED,MAAI,gCAAkBb,IAAlB,EAAwBiB,SAA5B,EAAuC;AACrC,UAAMjB,IAAI;AACPY,IAAAA,GADG,CACC,MADD;AAEHC,IAAAA,mBAFG;AAGF,wGAHE,CAAN;;AAKD;;AAED,QAAM,CAACK,YAAD,EAAeC,IAAI,GAAG,KAAtB,IAA+BX,YAArC;AACA,QAAMY,cAAc,GAAGF,YAAY,CAACG,MAApC;AACA,QAAMC,aAAa,GAAGf,QAAQ,CAACgB,WAAT,CAAqB,GAArB,CAAtB;AACA,QAAMC,IAAI,GAAGjB,QAAQ,CAACkB,KAAT,CAAeL,cAAf,EAA+BE,aAA/B,CAAb;AACA,QAAMI,IAAI,GAAG,oBAASzB,GAAG,CAACG,IAAJ,CAASuB,IAAT,CAAcC,cAAvB,CAAb;AACA,QAAMC,KAAK,GAAG3B,IAAI,CAAC4B,KAAL,IAAc5B,IAAI,CAAC4B,KAAL,CAAWC,SAAvC;;AAEA5B,EAAAA,IAAI,CAAC6B,IAAL,CAAU;AACRb,IAAAA,IADQ;AAERK,IAAAA,IAFQ;AAGRR,IAAAA,KAAK,EAAE,IAHC;AAIRiB,IAAAA,QAAQ,EAAEJ,KAAK,GAAGT,cAJV;AAKRc,IAAAA,MAAM,EAAEL,KAAK,GAAGP,aALR;AAMRtB,IAAAA,IAAI,EAAG,KAAI0B,IAAK,EANR;AAORS,IAAAA,WAAW,EAAG,KAAIT,IAAK,IAAGP,IAAK,EAPvB,EAAV;;;AAUAnB,EAAAA,IAAI,CAACoC,MAAL;AACD","sourcesContent":["import { basename } from \"path\";\nimport getComponentFiles from \"../../util/get-component-files\";\n\nconst STYLE_REG = /^style(?:\\.([^\\s]+))?\\s*\\{/;\n\nexport default function (path) {\n  const { hub, node } = path;\n  const { deps } = hub.file.metadata.marko;\n  const { rawValue } = node;\n  const matchedBlock = STYLE_REG.exec(rawValue);\n  if (!matchedBlock) {\n    return;\n  }\n\n  if (!path.parentPath.isProgram()) {\n    throw path\n      .get(\"name\")\n      .buildCodeFrameError(\n        \"Style blocks must be at the root of your Marko template.\"\n      );\n  }\n\n  if (deps.some(dep => dep.style)) {\n    throw path\n      .get(\"name\")\n      .buildCodeFrameError(\n        \"A Marko file can only contain a single inline style block.\"\n      );\n  }\n\n  if (getComponentFiles(path).styleFile) {\n    throw path\n      .get(\"name\")\n      .buildCodeFrameError(\n        'A Marko file can either have an inline style block, or an external \"style.ext\" file, but not both.'\n      );\n  }\n\n  const [startContent, type = \"css\"] = matchedBlock;\n  const codeSartOffset = startContent.length;\n  const codeEndOffset = rawValue.lastIndexOf(\"}\");\n  const code = rawValue.slice(codeSartOffset, codeEndOffset);\n  const base = basename(hub.file.opts.sourceFileName);\n  const start = node.extra && node.extra.nameStart;\n\n  deps.push({\n    type,\n    code,\n    style: true,\n    startPos: start + codeSartOffset,\n    endPos: start + codeEndOffset,\n    path: `./${base}`,\n    virtualPath: `./${base}.${type}`\n  });\n\n  path.remove();\n}\n"],"file":"transform-style.js"}