{"version":3,"sources":["../src/index.js"],"names":["analyze","Program","enter","program","exit","file","hub","meta","metadata","marko","styleFile","packageFile","componentBrowserFile","deps","unshift","hasComponentBrowser","component","hasComponent","hasStatefulTagParams","opts","sourceFileName","map","filename","imports","node","body","filter","child","t","isImportDeclaration","source","value","MarkoTag","tag","tagDef","html","template","renderer","htmlType","parseOptions","import","push","dir","get","isStringLiteral","relativePath","resolveRelativeTagEntry","extra","tags","includes","translator","path","watchFiles","length","curTag","tagFile","childMeta","ImportDeclaration","tagEntry","translate","MarkoDocumentType","MarkoDeclaration","MarkoCDATA","MarkoText","MarkoPlaceholder","MarkoScriptlet","MarkoClass","MarkoComment","markoOpts","output","resolveVirtualDependency","moduleCode","replaceWith","skip","_componentDefIdentifier","scope","generateUidIdentifier","renderBlock","pushContainer","blockStatement","isRenderContent","forEach","childPath","remove","_renderBlock","_inlineComponentClass","includeMetaInSource","componentFile","isHTML","componentClass","objectExpression","componentIdentifier","componentTypeIdentifier","templateIdentifier","rendererIdentifier","templateRendererMember","memberExpression","identifier","templateMetaMember","writeVersionComment","addComment","version","runtimeTemplateIdentifier","unshiftContainer","importDeclaration","importSpecifier","stringLiteral","optimize","hot","variableDeclaration","variableDeclarator","id","callExpression","expressionStatement","assignmentExpression","exportDefaultDeclaration","Boolean","arrowFunctionExpression","templateRenderOptionsProps","objectProperty","booleanLiteral","functionExpression","metaObject","properties","JSON","stringify","code","arrayExpression","getRuntimeEntryFiles","base","MARKO_TYPES","type","static","entry"],"mappings":"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","sourcesContent":["import { resolve } from \"path\";\nimport { types as t } from \"@marko/compiler\";\nimport {\n  parseExpression,\n  resolveTagImport,\n  resolveRelativePath,\n  importNamed,\n  importDefault,\n  parseScript,\n  isNativeTag,\n  isMacroTag,\n  isDynamicTag,\n  isAttributeTag,\n  loadFileForTag,\n  findParentTag,\n  getTagDef\n} from \"@marko/babel-utils\";\nimport { version } from \"marko/package.json\";\nimport MarkoDocumentType from \"./document-type\";\nimport MarkoDeclaration from \"./declaration\";\nimport MarkoCDATA from \"./cdata\";\nimport MarkoTag from \"./tag\";\nimport MarkoText from \"./text\";\nimport MarkoPlaceholder from \"./placeholder\";\nimport MarkoComment from \"./comment\";\nimport MarkoScriptlet from \"./scriptlet\";\nimport MarkoClass from \"./class\";\nimport { analyzeStaticVDOM } from \"./util/optimize-vdom-create\";\nimport { optimizeHTMLWrites } from \"./util/optimize-html-writes\";\nimport getComponentFiles from \"./util/get-component-files\";\nimport addDependencies from \"./util/add-dependencies\";\n\nexport { default as taglibs } from \"./taglib\";\n\nexport const analyze = {\n  Program: {\n    enter(program) {\n      // Pre populate metadata for component files.\n      getComponentFiles(program);\n    },\n    exit(program) {\n      const { file } = program.hub;\n      const meta = file.metadata.marko;\n      const {\n        styleFile,\n        packageFile,\n        componentBrowserFile\n      } = getComponentFiles(program);\n\n      if (packageFile) {\n        meta.deps.unshift(`package: ${packageFile}`);\n      }\n\n      if (styleFile) {\n        meta.deps.unshift(styleFile);\n      }\n\n      if (meta.hasComponentBrowser) {\n        meta.component = componentBrowserFile;\n      } else if (meta.hasComponent || meta.hasStatefulTagParams) {\n        meta.component = file.opts.sourceFileName;\n      }\n\n      meta.component =\n        meta.component && resolveRelativePath(file, meta.component);\n      meta.deps = meta.deps.map(filename =>\n        typeof filename === \"string\"\n          ? resolveRelativePath(file, filename)\n          : filename\n      );\n\n      meta.imports = program.node.body\n        .filter(child => t.isImportDeclaration(child))\n        .map(child => child.source.value);\n    }\n  },\n  MarkoTag(tag) {\n    const { file } = tag.hub;\n    const tagDef = getTagDef(tag);\n    // Check if tag uses stateful tag params.\n    const meta = tag.hub.file.metadata.marko;\n\n    if (tagDef) {\n      if (tagDef.html && !tagDef.template && !tagDef.renderer) {\n        if (tagDef.htmlType === \"custom-element\") {\n          if (tagDef.parseOptions && tagDef.parseOptions.import) {\n            // TODO: the taglib should be updated to support this as a top level option.\n            meta.deps.push(\n              resolve(\n                tagDef.dir,\n                resolve(tagDef.dir, tagDef.parseOptions.import)\n              )\n            );\n          }\n        }\n      } else if (tag.get(\"name\").isStringLiteral()) {\n        const relativePath = resolveRelativeTagEntry(file, tagDef);\n\n        if (relativePath) {\n          tag.node.extra = tag.node.extra || {};\n          tag.node.extra.relativePath = relativePath;\n\n          if (!meta.tags.includes(relativePath)) {\n            meta.tags.push(relativePath);\n          }\n        }\n      }\n\n      if (tagDef.translator && tagDef.translator.path) {\n        if (!meta.watchFiles.includes(tagDef.translator.path)) {\n          meta.watchFiles.push(tagDef.translator.path);\n        }\n      }\n    }\n\n    if (\n      meta.hasStatefulTagParams ||\n      isNativeTag(tag) ||\n      isMacroTag(tag) ||\n      !tag.get(\"body\").get(\"params\").length\n    ) {\n      return;\n    }\n\n    if (isDynamicTag(tag)) {\n      meta.hasStatefulTagParams = true;\n      return;\n    }\n\n    let curTag = tag;\n    while (isAttributeTag(curTag)) {\n      curTag = findParentTag(curTag);\n    }\n\n    const tagFile = loadFileForTag(curTag);\n    const childMeta = tagFile && tagFile.metadata.marko;\n    meta.hasStatefulTagParams =\n      childMeta &&\n      (childMeta.hasStatefulTagParams ||\n        (childMeta.hasComponent && !childMeta.hasComponentBrowser));\n  },\n  ImportDeclaration: {\n    exit(path) {\n      const source = path.get(\"source\");\n      const tagEntry = resolveTagImport(source, source.node.value);\n\n      if (tagEntry) {\n        const meta = path.hub.file.metadata.marko;\n        source.node.value = tagEntry;\n\n        if (!meta.tags.includes(tagEntry)) {\n          meta.tags.push(tagEntry);\n        }\n      }\n    }\n  }\n};\n\nexport const translate = {\n  MarkoDocumentType,\n  MarkoDeclaration,\n  MarkoCDATA,\n  MarkoTag,\n  MarkoText,\n  MarkoPlaceholder,\n  MarkoScriptlet,\n  MarkoClass,\n  MarkoComment,\n  Program: {\n    enter(path) {\n      const {\n        hub: { file }\n      } = path;\n\n      if (file.markoOpts.output === \"hydrate\") {\n        addDependencies(file, true);\n        return;\n      } else if (\n        file.markoOpts.resolveVirtualDependency &&\n        file.markoOpts.output !== \"html\"\n      ) {\n        addDependencies(file, false);\n      }\n\n      if (file.metadata.marko.moduleCode) {\n        path\n          .replaceWith(parseScript(file, file.metadata.marko.moduleCode))[0]\n          .skip();\n        return;\n      }\n\n      file._componentDefIdentifier = path.scope.generateUidIdentifier(\n        \"component\"\n      );\n\n      // Pre-Analyze tree\n      analyzeStaticVDOM(path);\n\n      // Move non static content into the renderBody.\n      const [renderBlock] = path.pushContainer(\"body\", t.blockStatement([]));\n      path\n        .get(\"body\")\n        .filter(isRenderContent)\n        .forEach(childPath => {\n          renderBlock.pushContainer(\"body\", childPath.node);\n          childPath.remove();\n        });\n\n      file._renderBlock = renderBlock;\n    },\n    exit(path) {\n      const {\n        hub: { file }\n      } = path;\n      const { markoOpts, _inlineComponentClass } = file;\n      const includeMetaInSource = markoOpts.meta !== false;\n      const meta = file.metadata.marko;\n      const { componentFile, componentBrowserFile } = getComponentFiles(path);\n      const isHTML = markoOpts.output === \"html\";\n\n      const renderBlock = file._renderBlock;\n      const componentClass =\n        (componentFile &&\n          importDefault(\n            file,\n            resolveRelativePath(file, componentFile),\n            \"marko_component\"\n          )) ||\n        _inlineComponentClass ||\n        t.objectExpression([]);\n\n      const componentIdentifier = path.scope.generateUidIdentifier(\n        \"marko_component\"\n      );\n      const componentTypeIdentifier = path.scope.generateUidIdentifier(\n        \"marko_componentType\"\n      );\n      const templateIdentifier = path.scope.generateUidIdentifier(\n        \"marko_template\"\n      );\n      const rendererIdentifier = importDefault(\n        file,\n        \"marko/src/runtime/components/renderer\",\n        \"marko_renderer\"\n      );\n      const templateRendererMember = t.memberExpression(\n        templateIdentifier,\n        t.identifier(\"_\")\n      );\n      const templateMetaMember = t.memberExpression(\n        templateIdentifier,\n        t.identifier(\"meta\")\n      );\n\n      if (markoOpts.writeVersionComment) {\n        path.addComment(\n          \"leading\",\n          ` Compiled using marko@${version} - DO NOT EDIT`,\n          true\n        );\n      }\n\n      const runtimeTemplateIdentifier = path.scope.generateUidIdentifier(\"t\");\n\n      path.unshiftContainer(\n        \"body\",\n        [\n          t.importDeclaration(\n            [t.importSpecifier(runtimeTemplateIdentifier, t.identifier(\"t\"))],\n            t.stringLiteral(\n              `marko/${markoOpts.optimize ? \"dist\" : \"src\"}/runtime/${\n                isHTML ? \"html\" : \"vdom\"\n              }${markoOpts.hot ? \"/hot-reload\" : \"\"}`\n            )\n          ),\n          t.variableDeclaration(\"const\", [\n            t.variableDeclarator(\n              componentTypeIdentifier,\n              t.stringLiteral(meta.id)\n            ),\n            t.variableDeclarator(\n              templateIdentifier,\n              t.callExpression(runtimeTemplateIdentifier, [\n                componentTypeIdentifier\n              ])\n            )\n          ]),\n          includeMetaInSource &&\n            t.expressionStatement(\n              t.assignmentExpression(\n                \"=\",\n                t.memberExpression(templateIdentifier, t.identifier(\"path\")),\n                t.identifier(\"__filename\")\n              )\n            ),\n          t.exportDefaultDeclaration(templateIdentifier)\n        ].filter(Boolean)\n      );\n\n      path.pushContainer(\n        \"body\",\n        [\n          !isHTML &&\n            t.expressionStatement(\n              t.callExpression(\n                importNamed(\n                  file,\n                  \"marko/src/runtime/components/registry\",\n                  \"r\",\n                  \"marko_registerComponent\"\n                ),\n                [\n                  componentTypeIdentifier,\n                  t.arrowFunctionExpression(\n                    [],\n                    componentBrowserFile\n                      ? importDefault(\n                          file,\n                          resolveRelativePath(file, componentBrowserFile),\n                          \"marko_split_component\"\n                        )\n                      : templateIdentifier\n                  )\n                ]\n              )\n            ),\n          t.variableDeclaration(\"const\", [\n            t.variableDeclarator(componentIdentifier, componentClass)\n          ])\n        ].filter(Boolean)\n      );\n\n      const templateRenderOptionsProps = [\n        t.objectProperty(t.identifier(\"t\"), componentTypeIdentifier)\n      ];\n\n      if (!meta.component) {\n        templateRenderOptionsProps.push(\n          t.objectProperty(t.identifier(\"i\"), t.booleanLiteral(true))\n        );\n      }\n\n      if (componentBrowserFile) {\n        templateRenderOptionsProps.push(\n          t.objectProperty(t.identifier(\"s\"), t.booleanLiteral(true))\n        );\n      }\n\n      if (!markoOpts.optimize) {\n        templateRenderOptionsProps.push(\n          t.objectProperty(t.identifier(\"d\"), t.booleanLiteral(true))\n        );\n      }\n\n      path.pushContainer(\n        \"body\",\n        t.expressionStatement(\n          t.assignmentExpression(\n            \"=\",\n            templateRendererMember,\n            t.callExpression(rendererIdentifier, [\n              t.functionExpression(\n                null,\n                [\n                  t.identifier(\"input\"),\n                  t.identifier(\"out\"),\n                  file._componentDefIdentifier,\n                  t.identifier(\"component\"),\n                  t.identifier(\"state\")\n                ],\n                renderBlock.node\n              ),\n              t.objectExpression(templateRenderOptionsProps),\n              componentIdentifier\n            ])\n          )\n        )\n      );\n      renderBlock.remove();\n\n      if (!isHTML) {\n        path.pushContainer(\n          \"body\",\n          t.expressionStatement(\n            t.assignmentExpression(\n              \"=\",\n              t.memberExpression(templateIdentifier, t.identifier(\"Component\")),\n              t.callExpression(\n                importDefault(\n                  file,\n                  \"marko/src/runtime/components/defineComponent\",\n                  \"marko_defineComponent\"\n                ),\n                [componentIdentifier, templateRendererMember]\n              )\n            )\n          )\n        );\n      }\n\n      if (includeMetaInSource) {\n        const metaObject = t.objectExpression([\n          t.objectProperty(t.identifier(\"id\"), componentTypeIdentifier)\n        ]);\n\n        if (meta.component) {\n          metaObject.properties.push(\n            t.objectProperty(\n              t.identifier(\"component\"),\n              t.stringLiteral(meta.component)\n            )\n          );\n        }\n\n        if (meta.deps.length) {\n          metaObject.properties.push(\n            t.objectProperty(\n              t.identifier(\"deps\"),\n              parseExpression(file, JSON.stringify(meta.deps), file.code.length)\n            )\n          );\n        }\n\n        if (meta.tags.length) {\n          metaObject.properties.push(\n            t.objectProperty(\n              t.identifier(\"tags\"),\n              t.arrayExpression(meta.tags.map(tag => t.stringLiteral(tag)))\n            )\n          );\n        }\n\n        path.pushContainer(\n          \"body\",\n          t.expressionStatement(\n            t.assignmentExpression(\"=\", templateMetaMember, metaObject)\n          )\n        );\n      }\n\n      optimizeHTMLWrites(path);\n    }\n  }\n};\n\nexport function getRuntimeEntryFiles(output, optimize) {\n  const base = `marko/${optimize ? \"dist\" : \"src\"}/`;\n\n  return [\n    `${base}runtime/components`,\n    `${base}runtime/components/defineComponent`,\n    `${base}runtime/components/renderer`,\n    `${base}runtime/components/registry`,\n    `${base}runtime/components/attach-detach`,\n    `${base}runtime/helpers/assign`,\n    `${base}runtime/helpers/class-value`,\n    `${base}runtime/helpers/dynamic-tag`,\n    `${base}runtime/helpers/load-nested-tag`,\n    `${base}runtime/helpers/merge`,\n    `${base}runtime/helpers/render-tag`,\n    `${base}runtime/helpers/style-value`,\n    `${base}runtime/helpers/to-string`,\n    `${base}core-tags/components/preserve-tag`,\n    `${base}core-tags/components/init-components-tag`,\n    `${base}core-tags/components/preferred-script-location-tag`,\n    `${base}core-tags/core/__flush_here_and_after__`,\n    `${base}core-tags/core/await/renderer`,\n    `${base}core-tags/core/await/reorderer-renderer`,\n    ...(output === \"html\"\n      ? [\n          `${base}runtime/html`,\n          `${base}runtime/html/hot-reload`,\n          `${base}runtime/html/helpers/attr`,\n          `${base}runtime/html/helpers/attrs`,\n          `${base}runtime/html/helpers/class-attr`,\n          `${base}runtime/html/helpers/data-marko`,\n          `${base}runtime/html/helpers/escape-quotes`,\n          `${base}runtime/html/helpers/escape-script-placeholder`,\n          `${base}runtime/html/helpers/escape-style-placeholder`,\n          `${base}runtime/html/helpers/escape-xml`,\n          `${base}runtime/html/helpers/merge-attrs`,\n          `${base}runtime/html/helpers/props-script`,\n          `${base}runtime/html/helpers/style-attr`\n        ]\n      : [\n          `${base}runtime/vdom`,\n          `${base}runtime/vdom/hot-reload`,\n          `${base}runtime/vdom/helpers/attrs`,\n          `${base}runtime/vdom/helpers/const`,\n          `${base}runtime/vdom/helpers/v-element`,\n          `${base}runtime/vdom/helpers/v-text`,\n          `${base}runtime/vdom/preserve-attrs`\n        ])\n  ];\n}\n\nfunction isRenderContent(path) {\n  const { node } = path;\n  return t.MARKO_TYPES.includes(node.type) && !node.static;\n}\n\nfunction resolveRelativeTagEntry(file, tagDef) {\n  // TODO: support transform and other entries.\n  const entry = tagDef.template || tagDef.renderer;\n  return entry && resolveRelativePath(file, entry);\n}\n"],"file":"index.js"}